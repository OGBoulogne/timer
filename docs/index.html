<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link id="fav" rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;,">
  <title id="title">Work</title>
<style>
/* font */
@font-face {
  font-family: 'IBM Plex Mono';
  font-style: normal;
  font-weight: 200;
  src: url(data:font/woff2;base64,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) format('woff2');
}
@font-face {
  font-family: 'IBM Plex Mono';
  font-style: normal;
  font-weight: 500;
  src: url(data:font/woff2;base64,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) format('woff2');
}


/* reset */
*, *:before, *:after { box-sizing: border-box }
html { font-size: 16px }
body, h1, h2, h3, h4, h5, h6, p, ol, ul { margin: 0; padding: 0; font-weight: normal }
ol, ul { list-style: none }
img { max-width: 100%; height: auto }

/* da style */
body, button {
  cursor: pointer;
  font-family: monospace;
  border: none;
}

#timer {
  font-family: 'IBM Plex Mono';
  font-size: 30vw;
  font-weight: 200;
  display: flex;
  justify-content: center;
  height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  align-items: center;
  user-select: none;
  transition: opacity 250ms;
}

.out-of-range #min, .out-of-range #sec { display: none }
#message:before { display: block }
#message:before { content: 'Pause session ended' }
.work #message:before { content: 'Work session ended' }

#message {
  font-family: monospace;
  display: none;
  font-size: 6vw;
  text-align: center;
}
.out-of-range #message { display: initial }

#min { font-weight: 500 }
#sign-in:hover { opacity: 1 }
#sign-in {
  opacity: 0;
  transition: opacity 750ms;
  position: fixed;
  border: 0;
  bottom: 0;
  right: 0;
  z-index: 1;
  transition: opacity 750ms;
}

#toolbar { position: fixed; z-index: 1; display: flex }
#bell, #fullscreen { outline: none; fill: currentColor }
#bell:not(.off) #sound-off,
#bell.off #sound-on,
#fullscreen:not(.off) #fullscreen-off,
#fullscreen.off #fullscreen-on { display: none }

/* light theme */
body,
button,
#timer { background: #fff; color: #222 }
#sec,
#message:before,
#bell:not(.off) { color: #888 }
.pause #min { color: #04b }
.pause #sec { color: #48f }
#timer.overtime #sec { color: #d75 }
#timer.overtime #min,
#bell.off { color: #c31 }

/* dark theme */
.dark body,
.dark button,
.dark #timer { background: #000; color: #eee }
.dark #sec,
.dark #message:before,
.dark #bell:not(.off),
.dark #fullscreen { color: #666 }
.dark .pause #min { color: #5bf }
.dark .pause #sec { color: #269 }
.dark #timer.overtime #sec { color: #a42 }
.dark #timer.overtime #min,
.dark #bell.off { color: #f53 }
</style>
</head>
<body>
<button id="sign-in" disabled>sign-in</button>
<div id="toolbar">
  <button id="bell" class="off">
    <svg id="sound-off" preserveAspectRatio="xMidYMid meet" height="50" width="50" viewBox="0 0 40 40"><path d="m30 24.5l-14.9-15.7c0.4-0.2 0.8-0.4 1.2-0.6h0l0.5-0.2c0.2-0.1 0.5-0.1 0.7-0.2v-1.2c0-1.4 1.1-2.5 2.5-2.5s2.5 1.1 2.5 2.5v1.2c4.8 1.2 7.5 5.4 7.5 10.6v6.1z m-10 12.1c-1.9 0-3.4-1.4-3.4-3.2h6.8c0 1.8-1.5 3.2-3.4 3.2z m-7-26.4c7.4 7.6 14.7 15.1 22 22.7l-2.1 2.1-3.4-3.4h-22.9v-1.6l3.4-3.4v-8.3c0-2.1 0.5-4.1 1.3-5.7l-4.7-4.6 2.2-2.2z"></path></svg>
    <svg id="sound-on" preserveAspectRatio="xMidYMid meet" height="50" width="50" viewBox="0 0 40 40"><path d="m30 26.6l3.4 3.4v1.6h-26.8v-1.6l3.4-3.4v-8.2c0-5.2 2.7-9.4 7.5-10.6v-1.2c0-1.4 1.1-2.5 2.5-2.5s2.5 1.1 2.5 2.5v1.2c4.8 1.2 7.5 5.5 7.5 10.6v8.2z m-10 10c-1.9 0-3.4-1.4-3.4-3.2h6.8c0 1.8-1.6 3.2-3.4 3.2z"></path></svg>
  </button>
  <button id="fullscreen" class="off">
    <svg id="fullscreen-off" preserveAspectRatio="xMidYMid meet" height="50" width="50" viewBox="0 0 40 40" style="vertical-align:middle;fill:#666"><path d="m23.4 8.4h8.2v8.2h-3.2v-5h-5v-3.2z m5 20v-5h3.2v8.2h-8.2v-3.2h5z m-20-11.8v-8.2h8.2v3.2h-5v5h-3.2z m3.2 6.8v5h5v3.2h-8.2v-8.2h3.2z"></path></svg>
    <svg id="fullscreen-on" preserveAspectRatio="xMidYMid meet" height="50" width="50" viewBox="0 0 40 40" style="vertical-align:middle;fill:#666"><path d="m26.6 13.4h5v3.2h-8.2v-8.2h3.2v5z m-3.2 18.2v-8.2h8.2v3.2h-5v5h-3.2z m-10-18.2v-5h3.2v8.2h-8.2v-3.2h5z m-5 13.2v-3.2h8.2v8.2h-3.2v-5h-5z"></path></svg>
  </button>
</div>
<div id="timer" class="work">
  <div id="message"></div>
  <div id="min">00</div><div id="sec">00</div>
</div>
<script>
'use strict'
// get relative time as text
const relatime = ((l,r,f=([u,s],d)=>r.format(~~(d/s),u))=>d=>f(l.find(([u,s])=>Math.abs(d)>s||u[0]=='s'),d))(Object.entries({year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4,second:1e3}),new Intl.RelativeTimeFormat('en',{style:'narrow'}))

// play notes
const play = (() => {
  let muted = true
  const signs = ['A','AS', 'B', 'C', 'CS', 'D', 'DS', 'E', 'F', 'FS', 'G', 'GS']
  // DF CS
  // EF DS
  // GF FS
  // AF GS
  // BF AS
  const tempo = 100
  const durations = {
    B: 128, // BREVE
    W: 64, // WHOLE
    H: 32, // HALF
    Q: 16, // QUARTER
    E: 8, // EIGHTH
    S: 4, // SIXTEENTH
    BD: 128+64, // BREVE DOT
    WD: 64+32, // WHOLE DOT
    HD: 32+16, // HALF DOT
    QD: 16+8, // QUARTER DOT
    ED: 8+4, // EIGHTH DOT
    SD: 4+2, // SIXTEENTH DOT
  }

  const context = new AudioContext()
  const types = ['sine', 'square', 'sawtooth', 'triangle']
  const notes = Object.fromEntries(signs.slice(0,8)
    .flatMap((_,o)=>signs.map((s,n)=>[s+(o+1),55*2**((12*o + n)/12)])))
  const noOp = () => {}
  const sound = (frequency, type = 'sine') => {
    const o = context.createOscillator()
    const g = context.createGain()
    o.type = type
    o.frequency.value = frequency
    o.connect(g)
    g.connect(context.destination)
    muted || o.start(0)
    return g
  }

  const chainNote = (next, noteStr) => () => {
    if (muted) return
    const [ note, rest = '' ] = noteStr.split('.')
    const duration = durations[rest.slice(0, -1)] / tempo
    const g = sound(notes[note], types[rest[rest.length - 1]])
    g.gain.exponentialRampToValueAtTime(1e-9, context.currentTime + duration)
    setTimeout(next, duration*1000)
  }
  const p = melody => melody.split('+').reduceRight(chainNote, noOp)()
  p.sound = sound
  p.mute = () => muted = true
  p.unmute = () => muted = false
  return p
})()

// create dom element
const el = (tag = 'div', props = {}) => Object.assign(document.createElement(tag), props)

// fix local time
const getTime = (() => {
  let offset = Number(localStorage.timeOffset) || 0
  let precision = Number(localStorage.timePrecision) || Infinity
  let iteration = 0
  const calcDiff = async () => {
    if (++iteration > 5) return
    const req = new XMLHttpRequest()
    const begin = Date.now()

    req.open('GET', `https://worldtimeapi.org/api/timezone/Europe/London`)
    let next
    req.onreadystatechange = () => next && next(req.readyState)
    req.send()
    while (await new Promise(s => next = s) < 2) {} // headers recieved
    const end = Date.now()
    const p = Math.floor((end - begin) / 2)
    if (p >= precision) return
    while (await new Promise(s => next = s) < 4) {} // done
    localStorage.timePrecision = precision = p
    localStorage.timeOffset = offset = JSON.parse(req.responseText).unixtime * 1000 + p - end
    console.log('update local time offset:', offset, 'precision', precision)
  }
  calcDiff()
  setInterval(calcDiff, 5000)
  return () => offset + Date.now()
})()

const mobile = /mobi|android|iphone|ipod|ipad/i.test(navigator.userAgent)
const dark = matchMedia('(prefers-color-scheme: dark)').matches
if (localStorage.theme === 'dark' || localStorage.theme ==! 'light' || dark) {
  document.documentElement.classList.add('dark')
}

const favEl = document.getElementById('fav')
const minEl = document.getElementById('min')
const secEl = document.getElementById('sec')
const bellEl = document.getElementById('bell')
const timerEl = document.getElementById('timer')
const titleEl = document.getElementById('title')
const signInEl = document.getElementById('sign-in')
const messageEl = document.getElementById('message')
const fullscreenEl = document.getElementById('fullscreen')

const S = 1000, M = 60*S, WORK_DURATION = 25*M, PAUSE_DURATION = 5*M
let _timeout, _db, _work = false

const save = async (now, prev) => {
  if (!_db) {
    const w = Number(localStorage.work === 'work')
    localStorage.stack = `${(localStorage.stack || '')}${now},${prev||0},${w}\n`
    console.log('offline update', localStorage.stack)
    return
  }

  // get prev, update duration
  await _db.timers
    .child(now.toString(36))
    .set({ ts: now, work: localStorage.work === 'work' })
}

const getColor = (work, overtime) => {
  if (overtime) return dark ? '#f53' : '#c31'
  if (work) return dark ? '#fff' : '#000'
  return dark ? '#5bf' : '#04b'
}
const setFav = (canvasEl => {
  const ctx = canvasEl.getContext('2d')
  const defaultColor = getColor(true)
  ctx.font = '84px "IBM Plex Mono"'
  ctx.textAlign = 'center'
  ctx.textBaseline = 'middle'
  favEl.type = 'image/png'

  return (text, color) => {
    ctx.clearRect(0, 0, 96, 96)
    ctx.fillStyle = color || defaultColor
    ctx.fillText(text, 48, 48)
    favEl.href = canvasEl.toDataURL('image/png')
  }
})(el('canvas', { width: '96', height: '96' }))
setFav('00')


const timings = [...Array(10).keys()].map(n => n ** 2 * M + 1)
const update = () => {
  // async loop
  Promise.resolve(clearTimeout(_timeout)).finally(() => {
    _timeout = setTimeout(update, (Math.floor((start + delta) / S) + 1) * S - now)
  })

  const work = localStorage.work === 'work'
  const wasWork = timerEl.classList.contains('work')
  const start = Number(localStorage.start)
  const now = getTime()
  const delta = now - Number(localStorage.start)
  const dur = work ? WORK_DURATION : PAUSE_DURATION
  const diff = dur - delta
  const overtime = delta > dur
  const left = overtime ? delta : diff + S
  const min = Math.floor(left / M)
  const outOfRange = overtime && min > 99

  timerEl.classList.toggle('work', work)
  timerEl.classList.toggle('pause', !work)
  timerEl.classList.toggle('overtime', overtime)
  timerEl.classList.toggle('out-of-range', outOfRange)

  if (outOfRange) return messageEl.textContent = relatime(diff)
  overtime && timings.find(t => -diff > t && -diff < t + S) && play('CS6.ED+A7.BD')
  const color = getColor(work, overtime)
  mobile || setFav(minEl.textContent = String(min).padStart(2, '0'), color)
  if (wasWork !== work) {
    titleEl.textContent = work ? 'Work' : 'Pause'
  }
  secEl.textContent = String(Math.floor(left / S) % 60).padStart(2, '0')
}

const toggleWork = work => localStorage.work = work ? 'work' : ''

timerEl.addEventListener('click', (e) => {
  const now = getTime()
  toggleWork(localStorage.work !== 'work')
  
  save(now, Number(localStorage.start))
  localStorage.start = now
  update()
})

if (localStorage.start) {
  timerEl.style.opacity = 0
  setTimeout(() => timerEl.style.opacity = 1, 15)
  update()
}

// BELL
bellEl.addEventListener('click', () => {
  const off = !bellEl.classList.contains('off')
  bellEl.classList.toggle('off', off)
  if (off) return play.mute()
  play.unmute()
  setTimeout(() => play('A7.ED+B7.ED+CS7.BD'), 150)
  mobile && play.sound(-22049) // play an unplayable sound to prevent sleep (to test)
})

// FULLSCREEN
fullscreenEl.addEventListener('click', () => {
  const off = document.fullscreenElement === document.documentElement
  fullscreenEl.classList.toggle('off', off)
  off
    ? document.exitFullscreen()
    : document.documentElement.requestFullscreen()

// DATABASE
const fetchText = async url => (await fetch(url)).text()
const loadScript = async urls => {
  const files = await Promise.all(urls.map(fetchText))
  document.head.appendChild(el('script', { innerHTML: files.join('\n') }))
}

const load = async () => {
  await loadScript([
    '/__/firebase/7.13.1/firebase-app.js',
    '/__/firebase/7.13.1/firebase-auth.js',
    '/__/firebase/7.13.1/firebase-database.js',
    '/__/firebase/init.js',
  ])
  return firebase.app()
}

const auth = async () => {
  const user = await getUser()
  return user ? { user } : firebase.auth().getRedirectResult()
    .catch(error => ({ error }))
}

const signIn = (e) => {
  // Start a sign in process for an unauthenticated user.
  const provider = new firebase.auth.GithubAuthProvider()
  firebase.auth().signInWithRedirect(provider)
}

const getUser = () => new Promise((s) => {
  firebase.auth().onAuthStateChanged(s)
})

const init = async app => {
  signInEl.disabled = false
  if (!app) {
    signInEl.textContent = `offline, retry`
    signInEl.onclick = () => {
      signInEl.disabled = true
      load().catch(console.error).then(init)
    }
    return
  }
  const { user, error } = await auth()
  signInEl.style.opacity = 1
  if (!user) {
    error && console.dir(error)
    signInEl.onclick = signIn
    return
  }
  _db = false
  signInEl.textContent = `${user.email} sign-out`
  // todo, handle sign out
  setTimeout(() => signInEl.style.opacity = '', 35000)
  const db = firebase.database()
  const timers = db.ref(user.uid)
  const lastTimers = timers.orderByChild('ts').limitToLast(1)

  const apply = snap => {
    if (!snap || !snap.val) return
    const { ts, work } = snap.val()
    if (ts < Number(localStorage.start)) return
    localStorage.start = ts
    toggleWork(work)
    update()
  }

  const [last] = Object.values((await lastTimers.once('value')).val() || {})
  last && apply(last)
  lastTimers.on('child_added', apply)

  timers.child(getTime().toString(36))
  _db = { timers }
}

load().catch(console.error).then(init)


</script>
</body>
</html>